import { EmailOtpType } from "@supabase/supabase-js";
import { AuthCallbackClient } from "@/components/auth/AuthCallbackClient";

interface AuthCallbackPageProps {
  searchParams?: Promise<Record<string, string | string[] | undefined>>;
}

function oneValue(value: string | string[] | undefined) {
  return Array.isArray(value) ? value[0] ?? null : value ?? null;
}

function getSafeNextPath(value: string | null) {
  if (!value || !value.startsWith("/")) {
    return "/";
  }

  return value;
}

export default async function AuthCallbackPage({ searchParams }: AuthCallbackPageProps) {
  const params = await searchParams;
  const nextPath = getSafeNextPath(oneValue(params?.next));
  const code = oneValue(params?.code);
  const tokenHash = oneValue(params?.token_hash);
  const type = oneValue(params?.type) as EmailOtpType | null;

  return (
    <AuthCallbackClient
      nextPath={nextPath}
      code={code}
      tokenHash={tokenHash}
      type={type}
    />
  );
}
